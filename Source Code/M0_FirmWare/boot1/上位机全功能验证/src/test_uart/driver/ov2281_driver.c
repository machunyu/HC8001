#include "i2c1_driver.h"
#include "gpio.h"
#include "cfg.h"
#include "dsp_cfg.h"  

	
#define TIME_MAX              0x400
#define TIME_MIN              0x40
#define CARSE_TIME            0x220

void ov2281_init(void)
{
	uint8_t ret=0;
	ISP_GAIN_CTRL = 0x04;

	//ISP_RX_TOTAL_NUM = 0x01000010;

	//ISP_RX_TH_MIN = 0x030f03ff;
	
	//ISP_RX_TH_MID = 0x01000010;

	//ISP_RX_TH_MAX = 0x030f03ff;
	
	GPIO0_CTRL = 0x00000001;//enable gpio0 block clock
	
	rGPIODIR |= (1<<1)|(1<<2);//设置pin1和pin2为输出
	
	rGPIO2DATA &=~ (1<<2); //设置stanby为低；
	
	rGPIO1DATA |= (1<<1);
		
	rGPIO1DATA &=~ (1<<1);//reset

	delay(1000*1000);
	
	rGPIO1DATA |= (1<<1);
	
	delay(400000);
#if 1
//===================================old src
	delay(400000);		
	i2c1_wr_8data(0x0103,0x01);	
	//delay(100*1000);		
	i2c1_wr_8data(0x0100,0x00);	
	//delay(100);	
	i2c1_wr_8data(0x0300, 0x04);		
	i2c1_wr_8data(0x0301, 0x00);			
	i2c1_wr_8data(0x0302, 0x69);//----840M
	i2c1_wr_8data(0x0303, 0x00);	
	i2c1_wr_8data(0x0304, 0x03);
	i2c1_wr_8data(0x0305, 0x01);
	i2c1_wr_8data(0x0306, 0x01);
	i2c1_wr_8data(0x030a, 0x00);
	i2c1_wr_8data(0x0312, 0x01);
	i2c1_wr_8data(0x030b, 0x00);
	i2c1_wr_8data(0x030c, 0x00);
	i2c1_wr_8data(0x030d, 0x1e);
	i2c1_wr_8data(0x030f, 0x06);
	i2c1_wr_8data(0x030e, 0x00);
	i2c1_wr_8data(0x3000, 0x00);
	i2c1_wr_8data(0x3002, 0x21);
	i2c1_wr_8data(0x3005, 0xf0);
	i2c1_wr_8data(0x3007, 0x00);
	i2c1_wr_8data(0x3015, 0x0f);
	i2c1_wr_8data(0x3018, 0x32);
	i2c1_wr_8data(0x301a, 0xf0);
	i2c1_wr_8data(0x301b, 0xf0);
	i2c1_wr_8data(0x301c, 0xf0);
	i2c1_wr_8data(0x301d, 0xf0);
	i2c1_wr_8data(0x301e, 0xf0);
	i2c1_wr_8data(0x3030, 0x00);
	i2c1_wr_8data(0x3031, 0x0a);
	i2c1_wr_8data(0x303c, 0xff);
	i2c1_wr_8data(0x303e, 0xff);
	i2c1_wr_8data(0x3040, 0xf0);
	i2c1_wr_8data(0x3041, 0x00);
	i2c1_wr_8data(0x3042, 0xf0);
	i2c1_wr_8data(0x3106, 0x11);
	i2c1_wr_8data(0x3500, 0x00);
	i2c1_wr_8data(0x3501, 0x45);
	i2c1_wr_8data(0x3502, 0x00);
	i2c1_wr_8data(0x3503, 0x04);
	i2c1_wr_8data(0x3504, 0x03);
	i2c1_wr_8data(0x3505, 0x83);
	i2c1_wr_8data(0x3508, 0x00);
	i2c1_wr_8data(0x3509, 0x80);
	i2c1_wr_8data(0x350e, 0x04);
	i2c1_wr_8data(0x350f, 0x00);
	i2c1_wr_8data(0x3510, 0x00);
	i2c1_wr_8data(0x3511, 0x02);
	i2c1_wr_8data(0x3512, 0x00);
	i2c1_wr_8data(0x3601, 0xc8);
	i2c1_wr_8data(0x3610, 0x88);
	i2c1_wr_8data(0x3612, 0x48);
	i2c1_wr_8data(0x3614, 0x5b);
	i2c1_wr_8data(0x3615, 0x96);
	i2c1_wr_8data(0x3621, 0xd0);
	i2c1_wr_8data(0x3622, 0x00);
	i2c1_wr_8data(0x3623, 0x00);
	i2c1_wr_8data(0x3633, 0x13);
	i2c1_wr_8data(0x3634, 0x13);
	i2c1_wr_8data(0x3635, 0x13);
	i2c1_wr_8data(0x3636, 0x13);
	i2c1_wr_8data(0x3645, 0x13);
	i2c1_wr_8data(0x3646, 0x82);
	i2c1_wr_8data(0x3650, 0x00);
	i2c1_wr_8data(0x3652, 0xff);
	i2c1_wr_8data(0x3655, 0x20);
	i2c1_wr_8data(0x3656, 0xff);
	i2c1_wr_8data(0x365a, 0xff);
	i2c1_wr_8data(0x365e, 0xff);
	i2c1_wr_8data(0x3668, 0x00);
	i2c1_wr_8data(0x366a, 0x07);
	i2c1_wr_8data(0x366e, 0x10);
	i2c1_wr_8data(0x366d, 0x00);
	i2c1_wr_8data(0x366f, 0x80);
	i2c1_wr_8data(0x3700, 0x28);
	i2c1_wr_8data(0x3701, 0x10);
	i2c1_wr_8data(0x3702, 0x3a);
	i2c1_wr_8data(0x3703, 0x19);
	i2c1_wr_8data(0x3704, 0x10);
	i2c1_wr_8data(0x3705, 0x00);
	i2c1_wr_8data(0x3706, 0x66);
	i2c1_wr_8data(0x3707, 0x08);
	i2c1_wr_8data(0x3708, 0x34);
	i2c1_wr_8data(0x3709, 0x40);
	i2c1_wr_8data(0x370a, 0x01);
	i2c1_wr_8data(0x370b, 0x1b);
	i2c1_wr_8data(0x3714, 0x24);
	i2c1_wr_8data(0x371a, 0x3e);
	i2c1_wr_8data(0x3733, 0x00);
	i2c1_wr_8data(0x3734, 0x00);
	i2c1_wr_8data(0x373a, 0x05);
	i2c1_wr_8data(0x373b, 0x06);
	i2c1_wr_8data(0x373c, 0x0a);
	i2c1_wr_8data(0x373f, 0xa0);
	i2c1_wr_8data(0x3755, 0x00);
	i2c1_wr_8data(0x3758, 0x00);
	i2c1_wr_8data(0x375b, 0x0e);
	i2c1_wr_8data(0x3766, 0x5f);
	i2c1_wr_8data(0x3768, 0x00);
	i2c1_wr_8data(0x3769, 0x22);
	i2c1_wr_8data(0x3773, 0x08);
	i2c1_wr_8data(0x3774, 0x1f);
	i2c1_wr_8data(0x3776, 0x06);
	i2c1_wr_8data(0x37a0, 0x88);
	i2c1_wr_8data(0x37a1, 0x5c);
	i2c1_wr_8data(0x37a7, 0x88);
	i2c1_wr_8data(0x37a8, 0x70);
	i2c1_wr_8data(0x37aa, 0x88);
	i2c1_wr_8data(0x37ab, 0x48);
	i2c1_wr_8data(0x37b3, 0x66);
	i2c1_wr_8data(0x37c2, 0x04);
	i2c1_wr_8data(0x37c5, 0x00);
	i2c1_wr_8data(0x37c8, 0x00);
	i2c1_wr_8data(0x3800, 0x00);
	i2c1_wr_8data(0x3801, 0x0c);
	i2c1_wr_8data(0x3802, 0x00);
	i2c1_wr_8data(0x3803, 0x04);
	i2c1_wr_8data(0x3804, 0x0a);
	i2c1_wr_8data(0x3805, 0x33);
	i2c1_wr_8data(0x3806, 0x07);
	i2c1_wr_8data(0x3807, 0xa3);
	i2c1_wr_8data(0x3808, 0x07);
	i2c1_wr_8data(0x3809, 0x80);
	i2c1_wr_8data(0x380a, 0x04);
	i2c1_wr_8data(0x380b, 0x38);
	i2c1_wr_8data(0x380c, 0x08);
	i2c1_wr_8data(0x380d, 0x98);
	i2c1_wr_8data(0x380e, 0x05);
	i2c1_wr_8data(0x380f, 0xdc);
	i2c1_wr_8data(0x3811, 0x04);
	i2c1_wr_8data(0x3813, 0x02);
	i2c1_wr_8data(0x3814, 0x01);
	i2c1_wr_8data(0x3815, 0x01);
	i2c1_wr_8data(0x3816, 0x00);
	i2c1_wr_8data(0x3817, 0x00);
	i2c1_wr_8data(0x3818, 0x00);
	i2c1_wr_8data(0x3819, 0x00);
	i2c1_wr_8data(0x3820, 0x00);
	i2c1_wr_8data(0x3821, 0x00);
	i2c1_wr_8data(0x3822, 0x48);
	i2c1_wr_8data(0x3826, 0x00);
	i2c1_wr_8data(0x3827, 0x08);
	i2c1_wr_8data(0x382a, 0x01);
	i2c1_wr_8data(0x382b, 0x01);
	i2c1_wr_8data(0x3830, 0x08);
	i2c1_wr_8data(0x3836, 0x02);
	i2c1_wr_8data(0x3837, 0x00);
	i2c1_wr_8data(0x3838, 0x10);
	i2c1_wr_8data(0x3841, 0xff);
	i2c1_wr_8data(0x3846, 0x48);
	i2c1_wr_8data(0x3861, 0x00);
	i2c1_wr_8data(0x3862, 0x04);
	i2c1_wr_8data(0x3863, 0x06);
	i2c1_wr_8data(0x3a11, 0x01);
	i2c1_wr_8data(0x3a12, 0x78);
	i2c1_wr_8data(0x3b00, 0x00);
	i2c1_wr_8data(0x3b02, 0x00);
	i2c1_wr_8data(0x3b03, 0x00);
	i2c1_wr_8data(0x3b04, 0x00);
	i2c1_wr_8data(0x3b05, 0x00);
	i2c1_wr_8data(0x3c00, 0x89);
	i2c1_wr_8data(0x3c01, 0xab);
	i2c1_wr_8data(0x3c02, 0x01);
	i2c1_wr_8data(0x3c03, 0x00);
	i2c1_wr_8data(0x3c04, 0x00);
	i2c1_wr_8data(0x3c05, 0x03);
	i2c1_wr_8data(0x3c06, 0x00);
	i2c1_wr_8data(0x3c07, 0x05);
	i2c1_wr_8data(0x3c0c, 0x00);
	i2c1_wr_8data(0x3c0d, 0x00);
	i2c1_wr_8data(0x3c0e, 0x00);
	i2c1_wr_8data(0x3c0f, 0x00);
	i2c1_wr_8data(0x3c40, 0x00);
	i2c1_wr_8data(0x3c41, 0xa3);
	i2c1_wr_8data(0x3c43, 0x7d);
	i2c1_wr_8data(0x3c45, 0xd7);
	i2c1_wr_8data(0x3c47, 0xfc);
	i2c1_wr_8data(0x3c50, 0x05);
	i2c1_wr_8data(0x3c52, 0xaa);
	i2c1_wr_8data(0x3c54, 0x71);
	i2c1_wr_8data(0x3c56, 0x80);
	i2c1_wr_8data(0x3d85, 0x17);
	i2c1_wr_8data(0x3f03, 0x00);
	i2c1_wr_8data(0x3f0a, 0x00);
	i2c1_wr_8data(0x3f0b, 0x00);		
	i2c1_wr_8data(0x4001, 0x60);
	i2c1_wr_8data(0x4009, 0x0d);
	i2c1_wr_8data(0x4020, 0x00);
	i2c1_wr_8data(0x4021, 0x00);
	i2c1_wr_8data(0x4022, 0x00);
	i2c1_wr_8data(0x4023, 0x00);
	i2c1_wr_8data(0x4024, 0x00);
	i2c1_wr_8data(0x4025, 0x00);
	i2c1_wr_8data(0x4026, 0x00);
	i2c1_wr_8data(0x4027, 0x00);
	i2c1_wr_8data(0x4028, 0x00);
	i2c1_wr_8data(0x4029, 0x00);		
	i2c1_wr_8data(0x402a, 0x00);
	i2c1_wr_8data(0x402b, 0x00);
	i2c1_wr_8data(0x402c, 0x00);
	i2c1_wr_8data(0x402d, 0x00);
	i2c1_wr_8data(0x402e, 0x00);
	i2c1_wr_8data(0x402f, 0x00);
	i2c1_wr_8data(0x4040, 0x00);
	i2c1_wr_8data(0x4041, 0x03);
	i2c1_wr_8data(0x4042, 0x00);
	i2c1_wr_8data(0x4043, 0x7A);
	i2c1_wr_8data(0x4044, 0x00);
	i2c1_wr_8data(0x4045, 0x7A);
	i2c1_wr_8data(0x4046, 0x00);	
	i2c1_wr_8data(0x4047, 0x7A);
	i2c1_wr_8data(0x4048, 0x00);
	i2c1_wr_8data(0x4049, 0x7A);
//	i2c1_wr_8data(0x4320, 0xff);//[7:6]:00:p3p4/p1p2 01:p4p3/p2p1 10:p1p2/p3p4 11:p2p1/p3p4
	                            //[5]:byte_awap
															//[4]:bit_reverse
															//[1]:solid_color_en
															//[0]:pn31_en		
//	i2c1_wr_8data(0x4850, 0x11);

//----------------------------
	i2c1_wr_8data(0x4813, 0x04);	
	i2c1_wr_8data(0x4814, 0x6b);
//----------------------------
	i2c1_wr_8data(0x4303, 0x00);//test	mode
	i2c1_wr_8data(0x4307, 0x30);
	i2c1_wr_8data(0x4500, 0x58);
	i2c1_wr_8data(0x4501, 0x04);
	i2c1_wr_8data(0x4502, 0x40);
	i2c1_wr_8data(0x4503, 0x10);
	i2c1_wr_8data(0x4508, 0xaa);
	i2c1_wr_8data(0x4509, 0xaa);
	i2c1_wr_8data(0x450a, 0x00);
	i2c1_wr_8data(0x450b, 0x00);
	i2c1_wr_8data(0x4600, 0x00);
	i2c1_wr_8data(0x4601, 0xc0);
	i2c1_wr_8data(0x4700, 0xa4);
	
	i2c1_wr_8data(0x4800, 0x5c);//---hvalid en
	
//	ret = i2c1_rd_data(0x4800);
//	ret++;
	
	i2c1_wr_8data(0x4816, 0x53);
	i2c1_wr_8data(0x481f, 0x40);
	i2c1_wr_8data(0x4837, 0x13);
	i2c1_wr_8data(0x5000, 0x56);
	i2c1_wr_8data(0x5001, 0x01);
	i2c1_wr_8data(0x5002, 0x28);
	i2c1_wr_8data(0x5004, 0x0c);
	i2c1_wr_8data(0x5006, 0x0c);
	i2c1_wr_8data(0x5007, 0xe0);
	i2c1_wr_8data(0x5008, 0x01);
	i2c1_wr_8data(0x5009, 0xb0);
	i2c1_wr_8data(0x5901, 0x00);
	i2c1_wr_8data(0x5a01, 0x00);		
	i2c1_wr_8data(0x5a03, 0x00);
	i2c1_wr_8data(0x5a04, 0x0c);
	i2c1_wr_8data(0x5a05, 0xe0);
	i2c1_wr_8data(0x5a06, 0x09);
	i2c1_wr_8data(0x5a07, 0xb0);
	i2c1_wr_8data(0x5a08, 0x06);
	i2c1_wr_8data(0x5e00, 0x00);
	i2c1_wr_8data(0x3734, 0x40);
	i2c1_wr_8data(0x5b00, 0x01);
	i2c1_wr_8data(0x5b01, 0x10);
	i2c1_wr_8data(0x5b02, 0x01);
	i2c1_wr_8data(0x5b03, 0xdb);		
	i2c1_wr_8data(0x3d8c, 0x71);
	i2c1_wr_8data(0x3d8d, 0xea);
	i2c1_wr_8data(0x4017, 0x08);
	i2c1_wr_8data(0x380c, 0x08);
	i2c1_wr_8data(0x380d, 0x98);
	i2c1_wr_8data(0x370b, 0x05);
	i2c1_wr_8data(0x400a, 0x01);
	i2c1_wr_8data(0x400b, 0x62);
	i2c1_wr_8data(0x3618, 0x2a);
	i2c1_wr_8data(0x5780, 0x3e);
	i2c1_wr_8data(0x5781, 0x0f);
	i2c1_wr_8data(0x5782, 0x44);
	i2c1_wr_8data(0x5783, 0x02);	
	i2c1_wr_8data(0x5784, 0x01);
	i2c1_wr_8data(0x5785, 0x01);
	i2c1_wr_8data(0x5786, 0x00);
	i2c1_wr_8data(0x5787, 0x04);	
	i2c1_wr_8data(0x5788, 0x02);
	i2c1_wr_8data(0x5789, 0x0f);
	i2c1_wr_8data(0x578a, 0xfd);
	i2c1_wr_8data(0x578b, 0xf5);
	i2c1_wr_8data(0x578c, 0xf5);
	i2c1_wr_8data(0x578d, 0x03);
	i2c1_wr_8data(0x578e, 0x08);
	i2c1_wr_8data(0x578f, 0x0c);
	i2c1_wr_8data(0x5790, 0x08);
	i2c1_wr_8data(0x5791, 0x06);
	i2c1_wr_8data(0x5792, 0x00);	
	i2c1_wr_8data(0x5793, 0x52);
	i2c1_wr_8data(0x5794, 0xa3);
	i2c1_wr_8data(0x3503, 0x00);
	i2c1_wr_8data(0x380e, 0x05);
	i2c1_wr_8data(0x380f, 0xdc);
	i2c1_wr_8data(0x3002, 0x61);
	i2c1_wr_8data(0x3010, 0x40);
	i2c1_wr_8data(0x300D, 0x00);
	i2c1_wr_8data(0x5045, 0x05);
	i2c1_wr_8data(0x5048, 0x10);
	i2c1_wr_8data(0x0100, 0x01);	
	delay(33*1000);
#endif

}


void DSP1_IRQHandler(void)
{
	DSP_CMD |= 0x10000;
}
